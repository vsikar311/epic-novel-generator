import openai
import os
import time

openai.api_key = os.getenv("OPENAI_API_KEY")

lore = """
Η ιστορία εκτυλίσσεται σε δύο κόσμους. Πρώτο κεφάλαιο: το τέλος της επανάστασης στη Γκραέλια,
μια φανταστική Ήπειρος όπου ανατρέπεται η Αυτοκράτειρα. Οι Κάνταλς – ερπετοειδείς ακόλουθοί της –
εξορίζονται στο σκοτεινό δάσος Νάργουελ. Η Αυτοκρατορία μετατρέπεται σε δημοκρατία με 4 βασίλεια:
Ξωτικά-Βαμπίρ, Νάνοι Άρχοντες, Λυκάνθρωποι του Νότου και Μάγοι στο Κέντρο. Στον κόσμο των ανθρώπων,
μια δήμαρχος υιοθετεί τη Σούζαν, ένα μωρό που είναι η μετενσάρκωση της Αυτοκράτειρας. 16 χρόνια
μετά, η Σούζαν επιστρέφει στη Γκραέλια μέσω μιας πύλης... και η ιστορία ξεκινά.
"""

chapters = [
    "Κεφάλαιο 1: Η βασίλισσα των Ξωτικών ανακοινώνει τη Δημοκρατία",
    "Κεφάλαιο 2: Παράξενα φαινόμενα στην πόλη των ανθρώπων",
    "Κεφάλαιο 3: Η Σούζαν και τα πρώτα σημάδια μαγείας",
    "Κεφάλαιο 4: Η πύλη ανοίγει στο λύκειο",
    "Κεφάλαιο 5: Ο Πειρατής αποκαλύπτει την αλήθεια",
    "Κεφάλαιο 6: Το ταξίδι στη Θάλασσα των Θρήνων",
    "Κεφάλαιο 7: Οι Κάνταλς και η υπόσχεση της Σούζαν",
    "Κεφάλαιο 8: Η τελική μάχη και η επιστροφή του θρόνου"
]

def γράψε_κεφάλαιο(τίτλος):
    prompt = f"""
Εσύ είσαι ένας συγγραφέας επικής φαντασίας. Βασίσου στον εξής κόσμο:

{lore}

Γράψε το εξής κεφάλαιο:
{τίτλος}

Το ύφος να είναι λογοτεχνικό, επικό, σκοτεινό και πλούσιο σε εικόνες. Χώρισε το σε παραγράφους.
"""

    response = openai.ChatCompletion.create(
        model="gpt-4-turbo",
        messages=[
            {"role": "system", "content": "Είσαι ένας κορυφαίος συγγραφέας φαντασίας."},
            {"role": "user", "content": prompt}
        ],
        temperature=0.9
    )

    return response["choices"][0]["message"]["content"]

if __name__ == "__main__":
    os.makedirs("book", exist_ok=True)
    print("\n📖 Δημιουργία μυθιστορήματος ξεκίνησε...\n")

    for i, κεφάλαιο in enumerate(chapters, start=1):
        print(f"✍️ Γράφεται: {κεφάλαιο}...")
        κείμενο = γράψε_κεφάλαιο(κεφάλαιο)

        filename = f"book/chapter_{i}.txt"
        with open(filename, "w", encoding="utf-8") as f:
            f.write(κεφάλαιο + "\n\n")
            f.write(κείμενο)

        print(f"✅ Αποθηκεύτηκε: {filename}\n")
        time.sleep(2)

    print("\n✅ Όλα τα κεφάλαια ολοκληρώθηκαν!")
